<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLB 3D æ¨¡å‹é¡¯ç¤ºï¼ˆPBR æè³ªå„ªåŒ–ï¼‰</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.outputEncoding = THREE.sRGBEncoding;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;
        document.body.appendChild(renderer.domElement);

        // ğŸ“ æ§åˆ¶å™¨ï¼ˆæ”¯æ´æ—‹è½‰ã€ç¸®æ”¾ã€å¹³ç§»ï¼‰
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // ğŸ”§ é¡¯ç¤ºè¼”åŠ©å·¥å…·
        scene.add(new THREE.AxesHelper(5));
        scene.add(new THREE.GridHelper(10, 10));

        // ğŸï¸ ä½¿ç”¨ HDR è²¼åœ–æé«˜ PBR æè³ªæ•ˆæœ
        const rgbeLoader = new THREE.RGBELoader();
        rgbeLoader.load('https://changyungfu.github.io/3D_Model/Glow_Kitchen_HDR.hdr', function (texture) {
            texture.mapping = THREE.EquirectangularReflectionMapping;
            scene.environment = texture;  // è¨­å®šç’°å¢ƒè²¼åœ–
            renderer.render(scene, camera);
        });

        // ğŸ— è¼‰å…¥ `.glb` æ¨¡å‹
        const modelURL = 'https://changyungfu.github.io/3D_Model/HualienTech_LogoAniV3.glb';
        const loader = new THREE.GLTFLoader();
        loader.load(modelURL, function (gltf) {
            const model = gltf.scene;
            scene.add(model);
            console.log("âœ… GLB æˆåŠŸè¼‰å…¥");

            // ğŸ¥ ä½¿ç”¨ GLB å…§å»ºç›¸æ©Ÿï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
            if (gltf.cameras.length > 0) {
                camera.copy(gltf.cameras[0]);
                console.log("ğŸ“¸ ä½¿ç”¨ GLB å…§å»ºç›¸æ©Ÿï¼");
            }

            // ğŸŒ å•Ÿç”¨ GLB å…§å»ºç‡ˆå…‰
            gltf.scene.traverse((obj) => {
                if (obj.isLight) {
                    scene.add(obj);
                    console.log("ğŸ’¡ ä½¿ç”¨ GLB å…§å»ºç‡ˆå…‰ï¼");
                }
            });

            // ğŸ¨ å„ªåŒ– PBR æè³ª
            model.traverse((node) => {
                if (node.isMesh) {
                    node.material = new THREE.MeshPhysicalMaterial({
                        color: node.material.color, // ä¿æŒ GLB åŸå§‹é¡è‰²
                        metalness: 0.6, // é‡‘å±¬æ„Ÿ (0~1)
                        roughness: 0.8, // å¢åŠ éœ§é¢æ•ˆæœ
                        envMapIntensity: 1.5, // ç’°å¢ƒå…‰å½±éŸ¿åŠ›
                        clearcoat: 0.4, // å¢åŠ ä¸€å±¤æ¸…æ¼†ï¼Œè®“é‡‘å±¬æ›´äº®
                        clearcoatRoughness: 0.3, // è®“æ¸…æ¼†å±¤æœ‰é»éœ§é¢
                        transmission: 0.0, // é€æ˜åº¦ (ç»ç’ƒå¯èª¿é«˜)
                        ior: 1.5, // æŠ˜å°„ç‡ï¼Œç»ç’ƒç´„ 1.5
                        transparent: true,
                        opacity: 0.8,
                    });
                if (node.isMesh || node.isObject3D) {
                    node.scale.set(1, 1.3, 1); // ç¢ºä¿ XYZ ç¸®æ”¾ä¸€è‡´
                }
                    node.material.needsUpdate = true;
                }
            });

            // ğŸ¬ å•Ÿå‹•å‹•ç•«
            if (gltf.animations.length > 0) {
                mixer = new THREE.AnimationMixer(model);
                gltf.animations.forEach((clip) => {
                    mixer.clipAction(clip).play();
                });
                console.log("ğŸ¬ å‹•ç•«å·²å•Ÿå‹•ï¼");
            }
        }, undefined, function (error) {
            console.error("âŒ GLB åŠ è¼‰å¤±æ•—", error);
        });

        // ğŸ•¹ è¨­å®šå‹•ç•«è¿´åœˆ
        const clock = new THREE.Clock();
        let mixer;
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            if (mixer) mixer.update(clock.getDelta());
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
